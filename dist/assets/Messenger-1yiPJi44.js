import{t as Le,u as yt,a as $e,r as w,b as vt,v as kt,a8 as Et,a1 as jt,a9 as wt,j as u,aa as pe,ab as ge,H as xt,ac as St}from"./index-NFJOMV6q.js";/* empty css                  */import{X as Re}from"./x-Gahxmuih.js";import{E as Tt}from"./ellipsis-vertical-Cmprk9TV.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ct=Le("image",It);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Fe=Le("send",_t);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Nt=Le("smile",Lt);function se(t){if(typeof t!="string"||!t)throw new Error("expected a non-empty string, got: "+t)}function be(t){if(typeof t!="number")throw new Error("expected a number, got: "+t)}const At=1,Ot=1,K="emoji",X="keyvalue",Ne="favorites",Dt="tokens",Xe="tokens",Mt="unicode",Ye="count",$t="group",Rt="order",Ze="group-order",Se="eTag",ue="url",Ue="skinTone",Y="readonly",Ae="readwrite",Je="skinUnicodes",Ft="skinUnicodes",Ut="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",Bt="en";function Pt(t,e){const n=new Set,r=[];for(const i of t){const o=e(i);n.has(o)||(n.add(o),r.push(i))}return r}function Be(t){return Pt(t,e=>e.unicode)}function zt(t){function e(n,r,i){const o=r?t.createObjectStore(n,{keyPath:r}):t.createObjectStore(n);if(i)for(const[a,[f,p]]of Object.entries(i))o.createIndex(a,f,{multiEntry:p});return o}e(X),e(K,Mt,{[Xe]:[Dt,!0],[Ze]:[[$t,Rt]],[Je]:[Ft,!0]}),e(Ne,void 0,{[Ye]:[""]})}const Te={},le={},fe={};function Qe(t,e,n){n.onerror=()=>e(n.error),n.onblocked=()=>e(new Error("IDB blocked")),n.onsuccess=()=>t(n.result)}async function Wt(t){const e=await new Promise((n,r)=>{const i=indexedDB.open(t,At);Te[t]=i,i.onupgradeneeded=o=>{o.oldVersion<Ot&&zt(i.result)},Qe(n,r,i)});return e.onclose=()=>Oe(t),e}function Gt(t){return le[t]||(le[t]=Wt(t)),le[t]}function U(t,e,n,r){return new Promise((i,o)=>{const a=t.transaction(e,n,{durability:"relaxed"}),f=typeof e=="string"?a.objectStore(e):e.map(c=>a.objectStore(c));let p;r(f,a,c=>{p=c}),a.oncomplete=()=>i(p),a.onerror=()=>o(a.error)})}function Oe(t){const e=Te[t],n=e&&e.result;if(n){n.close();const r=fe[t];if(r)for(const i of r)i()}delete Te[t],delete le[t],delete fe[t]}function Kt(t){return new Promise((e,n)=>{Oe(t);const r=indexedDB.deleteDatabase(t);Qe(e,n,r)})}function Vt(t,e){let n=fe[t];n||(n=fe[t]=[]),n.push(e)}const Ht=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function q(t){return t.split(/[\s_]+/).map(e=>!e.match(/\w/)||Ht.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase()).filter(Boolean)}const qt=2;function et(t){return t.filter(Boolean).map(e=>e.toLowerCase()).filter(e=>e.length>=qt)}function Xt(t){return t.map(({annotation:n,emoticon:r,group:i,order:o,shortcodes:a,skins:f,tags:p,emoji:c,version:h})=>{const g=[...new Set(et([...(a||[]).map(q).flat(),...(p||[]).map(q).flat(),...q(n),r]))].sort(),m={annotation:n,group:i,order:o,tags:p,tokens:g,unicode:c,version:h};if(r&&(m.emoticon=r),a&&(m.shortcodes=a),f){m.skinTones=[],m.skinUnicodes=[],m.skinVersions=[];for(const{tone:v,emoji:I,version:x}of f)m.skinTones.push(v),m.skinUnicodes.push(I),m.skinVersions.push(x)}return m})}function tt(t,e,n,r){t[e](n).onsuccess=i=>r&&r(i.target.result)}function G(t,e,n){tt(t,"get",e,n)}function nt(t,e,n){tt(t,"getAll",e,n)}function De(t){t.commit&&t.commit()}function Yt(t,e){let n=t[0];for(let r=1;r<t.length;r++){const i=t[r];e(n)>e(i)&&(n=i)}return n}function ot(t,e){const n=Yt(t,i=>i.length),r=[];for(const i of n)t.some(o=>o.findIndex(a=>e(a)===e(i))===-1)||r.push(i);return r}async function Zt(t){return!await Me(t,X,ue)}async function Jt(t,e,n){const[r,i]=await Promise.all([Se,ue].map(o=>Me(t,X,o)));return r===n&&i===e}async function Qt(t,e){return U(t,K,Y,(r,i,o)=>{let a;const f=()=>{r.getAll(a&&IDBKeyRange.lowerBound(a,!0),50).onsuccess=p=>{const c=p.target.result;for(const h of c)if(a=h.unicode,e(h))return o(h);if(c.length<50)return o();f()}};f()})}async function rt(t,e,n,r){try{const i=Xt(e);await U(t,[K,X],Ae,([o,a],f)=>{let p,c,h=0;function g(){++h===2&&m()}function m(){if(!(p===r&&c===n)){o.clear();for(const v of i)o.put(v);a.put(r,Se),a.put(n,ue),De(f)}}G(a,Se,v=>{p=v,g()}),G(a,ue,v=>{c=v,g()})})}finally{}}async function en(t,e){return U(t,K,Y,(n,r,i)=>{const o=IDBKeyRange.bound([e,0],[e+1,0],!1,!0);nt(n.index(Ze),o,i)})}async function it(t,e){const n=et(q(e));return n.length?U(t,K,Y,(r,i,o)=>{const a=[],f=()=>{a.length===n.length&&p()},p=()=>{const c=ot(a,h=>h.unicode);o(c.sort((h,g)=>h.order<g.order?-1:1))};for(let c=0;c<n.length;c++){const h=n[c],g=c===n.length-1?IDBKeyRange.bound(h,h+"￿",!1,!0):IDBKeyRange.only(h);nt(r.index(Xe),g,m=>{a.push(m),f()})}}):[]}async function tn(t,e){const n=await it(t,e);return n.length?n.filter(r=>(r.shortcodes||[]).map(o=>o.toLowerCase()).includes(e.toLowerCase()))[0]||null:await Qt(t,i=>(i.shortcodes||[]).includes(e.toLowerCase()))||null}async function nn(t,e){return U(t,K,Y,(n,r,i)=>G(n,e,o=>{if(o)return i(o);G(n.index(Je),e,a=>i(a||null))}))}function Me(t,e,n){return U(t,e,Y,(r,i,o)=>G(r,n,o))}function on(t,e,n,r){return U(t,e,Ae,(i,o)=>{i.put(r,n),De(o)})}function rn(t,e){return U(t,Ne,Ae,(n,r)=>G(n,e,i=>{n.put((i||0)+1,e),De(r)}))}function sn(t,e,n){return n===0?[]:U(t,[Ne,K],Y,([r,i],o,a)=>{const f=[];r.index(Ye).openCursor(void 0,"prev").onsuccess=p=>{const c=p.target.result;if(!c)return a(f);function h(v){if(f.push(v),f.length===n)return a(f);c.continue()}const g=c.primaryKey,m=e.byName(g);if(m)return h(m);G(i,g,v=>{if(v)return h(v);c.continue()})}})}const ae="";function an(t,e){const n=new Map;for(const i of t){const o=e(i);for(const a of o){let f=n;for(let c=0;c<a.length;c++){const h=a.charAt(c);let g=f.get(h);g||(g=new Map,f.set(h,g)),f=g}let p=f.get(ae);p||(p=[],f.set(ae,p)),p.push(i)}}return(i,o)=>{let a=n;for(let c=0;c<i.length;c++){const h=i.charAt(c),g=a.get(h);if(g)a=g;else return[]}if(o)return a.get(ae)||[];const f=[],p=[a];for(;p.length;){const h=[...p.shift().entries()].sort((g,m)=>g[0]<m[0]?-1:1);for(const[g,m]of h)g===ae?f.push(...m):p.push(m)}return f}}const cn=["name","url"];function ln(t){const e=t&&Array.isArray(t),n=e&&t.length&&(!t[0]||cn.some(r=>!(r in t[0])));if(!e||n)throw new Error("Custom emojis are in the wrong format")}function Pe(t){ln(t);const e=(m,v)=>m.name.toLowerCase()<v.name.toLowerCase()?-1:1,n=t.sort(e),i=an(t,m=>{const v=new Set;if(m.shortcodes)for(const I of m.shortcodes)for(const x of q(I))v.add(x);return v}),o=m=>i(m,!0),a=m=>i(m,!1),f=m=>{const v=q(m),I=v.map((x,C)=>(C<v.length-1?o:a)(x));return ot(I,x=>x.name).sort(e)},p=new Map,c=new Map;for(const m of t){c.set(m.name.toLowerCase(),m);for(const v of m.shortcodes||[])p.set(v.toLowerCase(),m)}return{all:n,search:f,byShortcode:m=>p.get(m.toLowerCase()),byName:m=>c.get(m.toLowerCase())}}const dn=typeof wrappedJSObject<"u";function ee(t){if(!t)return t;if(dn&&(t=structuredClone(t)),delete t.tokens,t.skinTones){const e=t.skinTones.length;t.skins=Array(e);for(let n=0;n<e;n++)t.skins[n]={tone:t.skinTones[n],unicode:t.skinUnicodes[n],version:t.skinVersions[n]};delete t.skinTones,delete t.skinUnicodes,delete t.skinVersions}return t}function st(t){t||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const un=["annotation","emoji","group","order","version"];function fn(t){if(!t||!Array.isArray(t)||!t[0]||typeof t[0]!="object"||un.some(e=>!(e in t[0])))throw new Error("Emoji data is in the wrong format")}function at(t,e){if(Math.floor(t.status/100)!==2)throw new Error("Failed to fetch: "+e+":  "+t.status)}async function mn(t){const e=await fetch(t,{method:"HEAD"});at(e,t);const n=e.headers.get("etag");return st(n),n}async function Ie(t){const e=await fetch(t);at(e,t);const n=e.headers.get("etag");st(n);const r=await e.json();return fn(r),[n,r]}function hn(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=-1;++i<r;)e+=String.fromCharCode(n[i]);return e}function pn(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=-1;++i<e;)r[i]=t.charCodeAt(i);return n}async function ct(t){const e=JSON.stringify(t);let n=pn(e);const r=await crypto.subtle.digest("SHA-1",n),i=hn(r);return btoa(i)}async function gn(t,e){let n,r=await mn(e);if(!r){const i=await Ie(e);r=i[0],n=i[1],r||(r=await ct(n))}await Jt(t,e,r)||(n||(n=(await Ie(e))[1]),await rt(t,n,e,r))}async function bn(t,e){let[n,r]=await Ie(e);n||(n=await ct(r)),await rt(t,r,e,n)}async function yn(t,e){try{await gn(t,e)}catch(n){if(n.name!=="InvalidStateError")throw n}}class vn{constructor({dataSource:e=Ut,locale:n=Bt,customEmoji:r=[]}={}){this.dataSource=e,this.locale=n,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=Pe(r),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await Gt(this._dbName);Vt(this._dbName,this._clear);const n=this.dataSource;await Zt(e)?await bn(e,n):this._lazyUpdate=yn(e,n)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return be(e),await this.ready(),Be(await en(this._db,e)).map(ee)}async getEmojiBySearchQuery(e){se(e),await this.ready();const n=this._custom.search(e),r=Be(await it(this._db,e)).map(ee);return[...n,...r]}async getEmojiByShortcode(e){se(e),await this.ready();const n=this._custom.byShortcode(e);return n||ee(await tn(this._db,e))}async getEmojiByUnicodeOrName(e){se(e),await this.ready();const n=this._custom.byName(e);return n||ee(await nn(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await Me(this._db,X,Ue)||0}async setPreferredSkinTone(e){return be(e),await this.ready(),on(this._db,X,Ue,e)}async incrementFavoriteEmojiCount(e){return se(e),await this.ready(),rn(this._db,e)}async getTopFavoriteEmoji(e){return be(e),await this.ready(),(await sn(this._db,this._custom,e)).map(ee)}set customEmoji(e){this._custom=Pe(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await Oe(this._dbName)}async delete(){await this._shutdown(),await Kt(this._dbName)}}const Ce=[[-1,"✨","custom"],[0,"😀","smileys-emotion"],[1,"👋","people-body"],[3,"🐱","animals-nature"],[4,"🍎","food-drink"],[5,"🏠️","travel-places"],[6,"⚽","activities"],[7,"📝","objects"],[8,"⛔️","symbols"],[9,"🏁","flags"]].map(([t,e,n])=>({id:t,emoji:e,name:n})),ye=Ce.slice(1),kn=2,ze=6,lt=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function We(t){return t.unicode.includes("‍")}const En={"🫩":16,"🫨":15.1,"🫠":14,"🥲":13.1,"🥻":12.1,"🥰":11,"🤩":5,"👱‍♀️":4,"🤣":3,"👁️‍🗨️":2,"😀":1,"😐️":.7,"😃":.6},jn=1e3,wn="🖐️",xn=8,Sn=["😊","😒","❤️","👍️","😍","😂","😭","☺️","😔","😩","😏","💕","🙌","😘"],dt='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',Tn=(t,e)=>t<e?-1:t>e?1:0,Ge=(t,e)=>{const n=document.createElement("canvas");n.width=n.height=1;const r=n.getContext("2d",{willReadFrequently:!0});return r.textBaseline="top",r.font=`100px ${dt}`,r.fillStyle=e,r.scale(.01,.01),r.fillText(t,0,0),r.getImageData(0,0,1,1).data},In=(t,e)=>{const n=[...t].join(","),r=[...e].join(",");return n===r&&!n.startsWith("0,0,0,")};function Cn(t){const e=Ge(t,"#000"),n=Ge(t,"#fff");return e&&n&&In(e,n)}function _n(){const t=Object.entries(En);try{for(const[e,n]of t)if(Cn(e))return n}catch{}finally{}return t[0][1]}let ve;const ke=()=>(ve||(ve=new Promise(t=>lt(()=>t(_n())))),ve),_e=new Map,Ln="️",Nn="\uD83C",An="‍",On=127995,Dn=57339;function Mn(t,e){if(e===0)return t;const n=t.indexOf(An);return n!==-1?t.substring(0,n)+String.fromCodePoint(On+e-1)+t.substring(n):(t.endsWith(Ln)&&(t=t.substring(0,t.length-1)),t+Nn+String.fromCodePoint(Dn+e-1))}function M(t){t.preventDefault(),t.stopPropagation()}function Ee(t,e,n){return e+=t?-1:1,e<0?e=n.length-1:e>=n.length&&(e=0),e}function ut(t,e){const n=new Set,r=[];for(const i of t){const o=e(i);n.has(o)||(n.add(o),r.push(i))}return r}function $n(t,e){const n=r=>{const i={};for(const o of r)typeof o.tone=="number"&&o.version<=e&&(i[o.tone]=o.unicode);return i};return t.map(({unicode:r,skins:i,shortcodes:o,url:a,name:f,category:p,annotation:c})=>({unicode:r,name:f,shortcodes:o,url:a,category:p,annotation:c,id:r||f,skins:i&&n(i)}))}const de=requestAnimationFrame;let Rn=typeof ResizeObserver=="function";function Fn(t,e,n){let r;Rn?(r=new ResizeObserver(n),r.observe(t)):de(n),e.addEventListener("abort",()=>{r&&r.disconnect()})}function Ke(t){{const e=document.createRange();return e.selectNode(t.firstChild),e.getBoundingClientRect().width}}let je;function Un(t,e,n){let r=!0;for(const i of t){const o=n(i);if(!o)continue;const a=Ke(o);typeof je>"u"&&(je=Ke(e));const f=a/1.8<je;_e.set(i.unicode,f),f||(r=!1)}return r}function Bn(t){return ut(t,e=>e)}function Pn(t){t&&(t.scrollTop=0)}function te(t,e,n){let r=t.get(e);return r||(r=n(),t.set(e,r)),r}function Ve(t){return""+t}function zn(t){const e=document.createElement("template");return e.innerHTML=t,e}const Wn=new WeakMap,Gn=new WeakMap,Kn=Symbol("un-keyed"),Vn="replaceChildren"in Element.prototype;function Hn(t,e){Vn?t.replaceChildren(...e):(t.innerHTML="",t.append(...e))}function qn(t,e){let n=t.firstChild,r=0;for(;n;){if(e[r]!==n)return!0;n=n.nextSibling,r++}return r!==e.length}function Xn(t,e){const{targetNode:n}=e;let{targetParentNode:r}=e,i=!1;r?i=qn(r,t):(i=!0,e.targetNode=void 0,e.targetParentNode=r=n.parentNode),i&&Hn(r,t)}function Yn(t,e){for(const n of e){const{targetNode:r,currentExpression:i,binding:{expressionIndex:o,attributeName:a,attributeValuePre:f,attributeValuePost:p}}=n,c=t[o];if(i!==c)if(n.currentExpression=c,a)if(c===null)r.removeAttribute(a);else{const h=f+Ve(c)+p;r.setAttribute(a,h)}else{let h;Array.isArray(c)?Xn(c,n):c instanceof Element?(h=c,r.replaceWith(h)):r.nodeValue=Ve(c),h&&(n.targetNode=h)}}}function Zn(t){let e="",n=!1,r=!1,i=-1;const o=new Map,a=[];let f=0;for(let c=0,h=t.length;c<h;c++){const g=t[c];if(e+=g.slice(f),c===h-1)break;for(let b=0;b<g.length;b++)switch(g.charAt(b)){case"<":{g.charAt(b+1)==="/"?a.pop():(n=!0,a.push(++i));break}case">":{n=!1,r=!1;break}case"=":{r=!0;break}}const m=a[a.length-1],v=te(o,m,()=>[]);let I,x,C;if(r){const b=/(\S+)="?([^"=]*)$/.exec(g);I=b[1],x=b[2];const j=/^([^">]*)("?)/.exec(t[c+1]);C=j[1],e=e.slice(0,-1*b[0].length),f=j[0].length}else f=0;const D={attributeName:I,attributeValuePre:x,attributeValuePost:C,expressionIndex:c};v.push(D),!n&&!r&&(e+=" ")}return{template:zn(e),elementsToBindings:o}}function He(t,e,n){for(let r=0;r<t.length;r++){const i=t[r],o=i.attributeName?e:e.firstChild,a={binding:i,targetNode:o,targetParentNode:void 0,currentExpression:void 0};n.push(a)}}function Jn(t,e){const n=[];let r;if(e.size===1&&(r=e.get(0)))He(r,t,n);else{const i=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT);let o=t,a=-1;do{const f=e.get(++a);f&&He(f,o,n)}while(o=i.nextNode())}return n}function Qn(t){const{template:e,elementsToBindings:n}=te(Wn,t,()=>Zn(t)),r=e.cloneNode(!0).content.firstElementChild,i=Jn(r,n);return function(a){return Yn(a,i),r}}function eo(t){const e=te(Gn,t,()=>new Map);let n=Kn;function r(o,...a){const f=te(e,o,()=>new Map);return te(f,n,()=>Qn(o))(a)}function i(o,a,f){return o.map((p,c)=>{const h=n;n=f(p);try{return a(p,c)}finally{n=h}})}return{map:i,html:r}}function to(t,e,n,r,i,o,a,f,p){const{labelWithSkin:c,titleForEmoji:h,unicodeWithSkin:g}=n,{html:m,map:v}=eo(e);function I(b,j,T){return v(b,(N,B)=>m`<button role="${j?"option":"menuitem"}" aria-selected="${j?B===e.activeSearchItem:null}" aria-label="${c(N,e.currentSkinTone)}" title="${h(N)}" class="${"emoji"+(j&&B===e.activeSearchItem?" active":"")+(N.unicode?"":" custom-emoji")}" id="${`${T}-${N.id}`}" style="${N.unicode?null:`--custom-emoji-background: url(${JSON.stringify(N.url)})`}">${N.unicode?g(N,e.currentSkinTone):""}</button>`,N=>`${T}-${N.id}`)}const C=m`<section data-ref="rootElement" class="picker" aria-label="${e.i18n.regionLabel}" style="${e.pickerStyle||""}"><div class="pad-top"></div><div class="search-row"><div class="search-wrapper"><input id="search" class="search" type="search" role="combobox" enterkeyhint="search" placeholder="${e.i18n.searchLabel}" autocapitalize="none" autocomplete="off" spellcheck="true" aria-expanded="${!!(e.searchMode&&e.currentEmojis.length)}" aria-controls="search-results" aria-describedby="search-description" aria-autocomplete="list" aria-activedescendant="${e.activeSearchItemId?`emo-${e.activeSearchItemId}`:null}" data-ref="searchElement" data-on-input="onSearchInput" data-on-keydown="onSearchKeydown"><label class="sr-only" for="search">${e.i18n.searchLabel}</label> <span id="search-description" class="sr-only">${e.i18n.searchDescription}</span></div><div class="skintone-button-wrapper ${e.skinTonePickerExpandedAfterAnimation?"expanded":""}"><button id="skintone-button" class="emoji ${e.skinTonePickerExpanded?"hide-focus":""}" aria-label="${e.skinToneButtonLabel}" title="${e.skinToneButtonLabel}" aria-describedby="skintone-description" aria-haspopup="listbox" aria-expanded="${e.skinTonePickerExpanded}" aria-controls="skintone-list" data-on-click="onClickSkinToneButton">${e.skinToneButtonText||""}</button></div><span id="skintone-description" class="sr-only">${e.i18n.skinToneDescription}</span><div data-ref="skinToneDropdown" id="skintone-list" class="skintone-list hide-focus ${e.skinTonePickerExpanded?"":"hidden no-animate"}" style="transform:translateY(${e.skinTonePickerExpanded?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))"})" role="listbox" aria-label="${e.i18n.skinTonesLabel}" aria-activedescendant="skintone-${e.activeSkinTone}" aria-hidden="${!e.skinTonePickerExpanded}" tabIndex="-1" data-on-focusout="onSkinToneOptionsFocusOut" data-on-click="onSkinToneOptionsClick" data-on-keydown="onSkinToneOptionsKeydown" data-on-keyup="onSkinToneOptionsKeyup">${v(e.skinTones,(b,j)=>m`<div id="skintone-${j}" class="emoji ${j===e.activeSkinTone?"active":""}" aria-selected="${j===e.activeSkinTone}" role="option" title="${e.i18n.skinTones[j]}" aria-label="${e.i18n.skinTones[j]}">${b}</div>`,b=>b)}</div></div><div class="nav" role="tablist" style="grid-template-columns:repeat(${e.groups.length},1fr)" aria-label="${e.i18n.categoriesLabel}" data-on-keydown="onNavKeydown" data-on-click="onNavClick">${v(e.groups,b=>m`<button role="tab" class="nav-button" aria-controls="tab-${b.id}" aria-label="${e.i18n.categories[b.name]}" aria-selected="${!e.searchMode&&e.currentGroup.id===b.id}" title="${e.i18n.categories[b.name]}" data-group-id="${b.id}"><div class="nav-emoji emoji">${b.emoji}</div></button>`,b=>b.id)}</div><div class="indicator-wrapper"><div class="indicator" style="transform:translateX(${(e.isRtl?-1:1)*e.currentGroupIndex*100}%)"></div></div><div class="message ${e.message?"":"gone"}" role="alert" aria-live="polite">${e.message||""}</div><div data-ref="tabpanelElement" class="tabpanel ${!e.databaseLoaded||e.message?"gone":""}" role="${e.searchMode?"region":"tabpanel"}" aria-label="${e.searchMode?e.i18n.searchResultsLabel:e.i18n.categories[e.currentGroup.name]}" id="${e.searchMode?null:`tab-${e.currentGroup.id}`}" tabIndex="0" data-on-click="onEmojiClick"><div data-action="calculateEmojiGridStyle">${v(e.currentEmojisWithCategories,(b,j)=>m`<div><div id="menu-label-${j}" class="category ${e.currentEmojisWithCategories.length===1&&e.currentEmojisWithCategories[0].category===""?"gone":""}" aria-hidden="true">${e.searchMode?e.i18n.searchResultsLabel:b.category?b.category:e.currentEmojisWithCategories.length>1?e.i18n.categories.custom:e.i18n.categories[e.currentGroup.name]}</div><div class="emoji-menu ${j!==0&&!e.searchMode&&e.currentGroup.id===-1?"visibility-auto":""}" style="${`--num-rows: ${Math.ceil(b.emojis.length/e.numColumns)}`}" data-action="updateOnIntersection" role="${e.searchMode?"listbox":"menu"}" aria-labelledby="menu-label-${j}" id="${e.searchMode?"search-results":null}">${I(b.emojis,e.searchMode,"emo")}</div></div>`,b=>b.category)}</div></div><div class="favorites onscreen emoji-menu ${e.message?"gone":""}" role="menu" aria-label="${e.i18n.favoritesLabel}" data-on-click="onEmojiClick">${I(e.currentFavorites,!1,"fav")}</div><button data-ref="baselineEmoji" aria-hidden="true" tabindex="-1" class="abs-pos hidden emoji baseline-emoji">😀</button></section>`,D=(b,j)=>{for(const T of t.querySelectorAll(`[${b}]`))j(T,T.getAttribute(b))};if(p){t.appendChild(C);for(const b of["click","focusout","input","keydown","keyup"])D(`data-on-${b}`,(j,T)=>{j.addEventListener(b,r[T])});D("data-ref",(b,j)=>{o[j]=b}),a.addEventListener("abort",()=>{t.removeChild(C)})}D("data-action",(b,j)=>{let T=f.get(j);T||f.set(j,T=new WeakSet),T.has(b)||(T.add(b),i[j](b))})}const me=typeof queueMicrotask=="function"?queueMicrotask:t=>Promise.resolve().then(t);function no(t){let e=!1,n;const r=new Map,i=new Set;let o;const a=()=>{if(e)return;const c=[...i];i.clear();try{for(const h of c)h()}finally{o=!1,i.size&&(o=!0,me(a))}},f=new Proxy({},{get(c,h){if(n){let g=r.get(h);g||(g=new Set,r.set(h,g)),g.add(n)}return c[h]},set(c,h,g){if(c[h]!==g){c[h]=g;const m=r.get(h);if(m){for(const v of m)i.add(v);o||(o=!0,me(a))}}return!0}}),p=c=>{const h=()=>{const g=n;n=h;try{return c()}finally{n=g}};return h()};return t.addEventListener("abort",()=>{e=!0}),{state:f,createEffect:p}}function we(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!n(t[r],e[r]))return!1;return!0}const qe=new WeakMap;function oo(t,e,n){{const r=t.closest(".tabpanel");let i=qe.get(r);i||(i=new IntersectionObserver(n,{root:r,rootMargin:"50% 0px 50% 0px",threshold:0}),qe.set(r,i),e.addEventListener("abort",()=>{i.disconnect()})),i.observe(t)}}const xe=[],{assign:ce}=Object;function ro(t,e){const n={},r=new AbortController,i=r.signal,{state:o,createEffect:a}=no(i),f=new Map;ce(o,{skinToneEmoji:void 0,i18n:void 0,database:void 0,customEmoji:void 0,customCategorySorting:void 0,emojiVersion:void 0}),ce(o,e),ce(o,{initialLoad:!0,currentEmojis:[],currentEmojisWithCategories:[],rawSearchText:"",searchText:"",searchMode:!1,activeSearchItem:-1,message:void 0,skinTonePickerExpanded:!1,skinTonePickerExpandedAfterAnimation:!1,currentSkinTone:0,activeSkinTone:0,skinToneButtonText:void 0,pickerStyle:void 0,skinToneButtonLabel:"",skinTones:[],currentFavorites:[],defaultFavoriteEmojis:void 0,numColumns:xn,isRtl:!1,currentGroupIndex:0,groups:ye,databaseLoaded:!1,activeSearchItemId:void 0}),a(()=>{o.currentGroup!==o.groups[o.currentGroupIndex]&&(o.currentGroup=o.groups[o.currentGroupIndex])});const p=s=>{t.getElementById(s).focus()},c=s=>t.getElementById(`emo-${s.id}`),h=(s,d)=>{n.rootElement.dispatchEvent(new CustomEvent(s,{detail:d,bubbles:!0,composed:!0}))},g=(s,d)=>s.id===d.id,m=(s,d)=>{const{category:y,emojis:E}=s,{category:_,emojis:L}=d;return y!==_?!1:we(E,L,g)},v=s=>{we(o.currentEmojis,s,g)||(o.currentEmojis=s)},I=s=>{o.searchMode!==s&&(o.searchMode=s)},x=s=>{we(o.currentEmojisWithCategories,s,m)||(o.currentEmojisWithCategories=s)},C=(s,d)=>d&&s.skins&&s.skins[d]||s.unicode,j={labelWithSkin:(s,d)=>Bn([s.name||C(s,d),s.annotation,...s.shortcodes||xe].filter(Boolean)).join(", "),titleForEmoji:s=>s.annotation||(s.shortcodes||xe).join(", "),unicodeWithSkin:C},T={onClickSkinToneButton:A,onEmojiClick:l,onNavClick:F,onNavKeydown:he,onSearchKeydown:oe,onSkinToneOptionsClick:S,onSkinToneOptionsFocusOut:gt,onSkinToneOptionsKeydown:W,onSkinToneOptionsKeyup:pt,onSearchInput:bt},N={calculateEmojiGridStyle:$,updateOnIntersection:z};let B=!0;a(()=>{to(t,o,j,T,N,n,i,f,B),B=!1}),o.emojiVersion||ke().then(s=>{s||(o.message=o.i18n.emojiUnsupportedMessage)}),a(()=>{async function s(){let d=!1;const y=setTimeout(()=>{d=!0,o.message=o.i18n.loadingMessage},jn);try{await o.database.ready(),o.databaseLoaded=!0}catch(E){console.error(E),o.message=o.i18n.networkErrorMessage}finally{clearTimeout(y),d&&(d=!1,o.message="")}}o.database&&s()}),a(()=>{o.pickerStyle=`
      --num-groups: ${o.groups.length}; 
      --indicator-opacity: ${o.searchMode?0:1}; 
      --num-skintones: ${ze};`}),a(()=>{o.customEmoji&&o.database&&ne()}),a(()=>{o.customEmoji&&o.customEmoji.length?o.groups!==Ce&&(o.groups=Ce):o.groups!==ye&&(o.currentGroupIndex&&o.currentGroupIndex--,o.groups=ye)}),a(()=>{async function s(){o.databaseLoaded&&(o.currentSkinTone=await o.database.getPreferredSkinTone())}s()}),a(()=>{o.skinTones=Array(ze).fill().map((s,d)=>Mn(o.skinToneEmoji,d))}),a(()=>{o.skinToneButtonText=o.skinTones[o.currentSkinTone]}),a(()=>{o.skinToneButtonLabel=o.i18n.skinToneLabel.replace("{skinTone}",o.i18n.skinTones[o.currentSkinTone])}),a(()=>{async function s(){const{database:d}=o,y=(await Promise.all(Sn.map(E=>d.getEmojiByUnicodeOrName(E)))).filter(Boolean);o.defaultFavoriteEmojis=y}o.databaseLoaded&&s()});function ne(){const{customEmoji:s,database:d}=o,y=s||xe;d.customEmoji!==y&&(d.customEmoji=y)}a(()=>{async function s(){ne();const{database:d,defaultFavoriteEmojis:y,numColumns:E}=o,_=await d.getTopFavoriteEmoji(E),L=await J(ut([..._,...y],O=>O.unicode||O.name).slice(0,E));o.currentFavorites=L}o.databaseLoaded&&o.defaultFavoriteEmojis&&s()});function $(s){Fn(s,i,()=>{{const d=getComputedStyle(n.rootElement),y=parseInt(d.getPropertyValue("--num-columns"),10),E=d.getPropertyValue("direction")==="rtl";o.numColumns=y,o.isRtl=E}})}function z(s){oo(s,i,d=>{for(const{target:y,isIntersecting:E}of d)y.classList.toggle("onscreen",E)})}a(()=>{async function s(){const{searchText:d,currentGroup:y,databaseLoaded:E,customEmoji:_}=o;if(!E)o.currentEmojis=[],o.searchMode=!1;else if(d.length>=kn){const L=await P(d);o.searchText===d&&(v(L),I(!0))}else{const{id:L}=y;if(L!==-1||_&&_.length){const O=await Q(L);o.currentGroup.id===L&&(v(O),I(!1))}}}s()});const V=()=>{de(()=>Pn(n.tabpanelElement))};a(()=>{const{currentEmojis:s,emojiVersion:d}=o,y=s.filter(E=>E.unicode).filter(E=>We(E)&&!_e.has(E.unicode));if(!d&&y.length)v(s),de(()=>Z(y));else{const E=d?s:s.filter(R);v(E),V()}});function Z(s){Un(s,n.baselineEmoji,c)?V():o.currentEmojis=[...o.currentEmojis]}function R(s){return!s.unicode||!We(s)||_e.get(s.unicode)}async function H(s){const d=o.emojiVersion||await ke();return s.filter(({version:y})=>!y||y<=d)}async function J(s){return $n(s,o.emojiVersion||await ke())}async function Q(s){const d=s===-1?o.customEmoji:await o.database.getEmojiByGroup(s);return J(await H(d))}async function P(s){return J(await H(await o.database.getEmojiBySearchQuery(s)))}a(()=>{}),a(()=>{function s(){const{searchMode:y,currentEmojis:E}=o;if(y)return[{category:"",emojis:E}];const _=new Map;for(const L of E){const O=L.category||"";let ie=_.get(O);ie||(ie=[],_.set(O,ie)),ie.push(L)}return[..._.entries()].map(([L,O])=>({category:L,emojis:O})).sort((L,O)=>o.customCategorySorting(L.category,O.category))}const d=s();x(d)}),a(()=>{o.activeSearchItemId=o.activeSearchItem!==-1&&o.currentEmojis[o.activeSearchItem].id}),a(()=>{const{rawSearchText:s}=o;lt(()=>{o.searchText=(s||"").trim(),o.activeSearchItem=-1})});function oe(s){if(!o.searchMode||!o.currentEmojis.length)return;const d=y=>{M(s),o.activeSearchItem=Ee(y,o.activeSearchItem,o.currentEmojis)};switch(s.key){case"ArrowDown":return d(!1);case"ArrowUp":return d(!0);case"Enter":if(o.activeSearchItem===-1)o.activeSearchItem=0;else return M(s),re(o.currentEmojis[o.activeSearchItem].id)}}function F(s){const{target:d}=s,y=d.closest(".nav-button");if(!y)return;const E=parseInt(y.dataset.groupId,10);n.searchElement.value="",o.rawSearchText="",o.searchText="",o.activeSearchItem=-1,o.currentGroupIndex=o.groups.findIndex(_=>_.id===E)}function he(s){const{target:d,key:y}=s,E=_=>{_&&(M(s),_.focus())};switch(y){case"ArrowLeft":return E(d.previousElementSibling);case"ArrowRight":return E(d.nextElementSibling);case"Home":return E(d.parentElement.firstElementChild);case"End":return E(d.parentElement.lastElementChild)}}async function re(s){const d=await o.database.getEmojiByUnicodeOrName(s),y=[...o.currentEmojis,...o.currentFavorites].find(_=>_.id===s),E=y.unicode&&C(y,o.currentSkinTone);await o.database.incrementFavoriteEmojiCount(s),h("emoji-click",{emoji:d,skinTone:o.currentSkinTone,...E&&{unicode:E},...y.name&&{name:y.name}})}async function l(s){const{target:d}=s;if(!d.classList.contains("emoji"))return;M(s);const y=d.id.substring(4);re(y)}function k(s){o.currentSkinTone=s,o.skinTonePickerExpanded=!1,p("skintone-button"),h("skin-tone-change",{skinTone:s}),o.database.setPreferredSkinTone(s)}function S(s){const{target:{id:d}}=s,y=d&&d.match(/^skintone-(\d)/);if(!y)return;M(s);const E=parseInt(y[1],10);k(E)}function A(s){o.skinTonePickerExpanded=!o.skinTonePickerExpanded,o.activeSkinTone=o.currentSkinTone,o.skinTonePickerExpanded&&(M(s),de(()=>p("skintone-list")))}a(()=>{o.skinTonePickerExpanded?n.skinToneDropdown.addEventListener("transitionend",()=>{o.skinTonePickerExpandedAfterAnimation=!0},{once:!0}):o.skinTonePickerExpandedAfterAnimation=!1});function W(s){if(!o.skinTonePickerExpanded)return;const d=async y=>{M(s),o.activeSkinTone=y};switch(s.key){case"ArrowUp":return d(Ee(!0,o.activeSkinTone,o.skinTones));case"ArrowDown":return d(Ee(!1,o.activeSkinTone,o.skinTones));case"Home":return d(0);case"End":return d(o.skinTones.length-1);case"Enter":return M(s),k(o.activeSkinTone);case"Escape":return M(s),o.skinTonePickerExpanded=!1,p("skintone-button")}}function pt(s){if(o.skinTonePickerExpanded)switch(s.key){case" ":return M(s),k(o.activeSkinTone)}}async function gt(s){const{relatedTarget:d}=s;(!d||d.id!=="skintone-list")&&(o.skinTonePickerExpanded=!1)}function bt(s){o.rawSearchText=s.target.value}return{$set(s){ce(o,s)},$destroy(){r.abort()}}}const io="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",so="en";var ao={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading…",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}},co=':host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--border-radius:0;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){color-scheme:light;--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;scrollbar-gutter:stable;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.emoji-menu.visibility-auto{content-visibility:auto;contain-intrinsic-size:calc(var(--num-columns)*var(--total-emoji-size)) calc(var(--num-rows)*var(--total-emoji-size))}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;height:var(--total-emoji-size);width:var(--total-emoji-size);line-height:1;overflow:hidden;font-family:var(--emoji-font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.onscreen .custom-emoji::after{content:"";width:var(--emoji-size);height:var(--emoji-size);background-repeat:no-repeat;background-position:center center;background-size:contain;background-image:var(--custom-emoji-background)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{overflow-y:auto;scrollbar-gutter:stable;display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}';const ft=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji","emojiVersion"],lo=`:host{--emoji-font-family:${dt}}`;class mt extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const n=document.createElement("style");n.textContent=co+lo,this.shadowRoot.appendChild(n),this._ctx={locale:so,dataSource:io,skinToneEmoji:wn,customCategorySorting:Tn,customEmoji:null,i18n:ao,emojiVersion:null,...e};for(const r of ft)r!=="database"&&Object.prototype.hasOwnProperty.call(this,r)&&(this._ctx[r]=this[r],delete this[r]);this._dbFlush()}connectedCallback(){this._cmp||(this._cmp=ro(this.shadowRoot,this._ctx))}disconnectedCallback(){me(()=>{if(!this.isConnected&&this._cmp){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e.close().catch(n=>console.error(n))}})}static get observedAttributes(){return["locale","data-source","skin-tone-emoji","emoji-version"]}attributeChangedCallback(e,n,r){this._set(e.replace(/-([a-z])/g,(i,o)=>o.toUpperCase()),e==="emoji-version"?parseFloat(r):r)}_set(e,n){this._ctx[e]=n,this._cmp&&this._cmp.$set({[e]:n}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:n,database:r}=this._ctx;(!r||r.locale!==e||r.dataSource!==n)&&this._set("database",new vn({locale:e,dataSource:n}))}_dbFlush(){me(()=>this._dbCreate())}}const ht={};for(const t of ft)ht[t]={get(){return t==="database"&&this._dbCreate(),this._ctx[t]},set(e){if(t==="database")throw new Error("database is read-only");this._set(t,e)}};Object.defineProperties(mt.prototype,ht);customElements.get("emoji-picker")||customElements.define("emoji-picker",mt);function po(){const t=yt(),{byId:e,active:n}=$e(l=>l.ChatReducer),r=$e(l=>l.userReducer?.user),[i,o]=w.useState(""),a=vt(),{id:f}=kt(),p=w.useRef(null),c=w.useRef(null),h=w.useRef(null),g=w.useRef(null),m=w.useRef(null),v=w.useRef(null),I=w.useRef(null),x=w.useMemo(()=>r?.userId?._id||r?.userId||r?._id||null,[r]),[C,D]=w.useState(!1),[b,j]=w.useState(!1),[T,N]=w.useState(!1),[B,ne]=w.useState(typeof document<"u"?document.visibilityState==="visible":!0),[$,z]=w.useState(!1),[V,Z]=w.useState(null),[R,H]=w.useState(""),[J,Q]=w.useState(""),[P,oe]=w.useState(!1),[F,he]=w.useState(null);w.useEffect(()=>{t(Et())},[t]),w.useEffect(()=>{if(f){if(x&&String(f)===String(x)){a("/messages",{replace:!0});return}t(jt(f))}},[f,x,t,a]),w.useEffect(()=>{let l=!1;async function k(){try{const{data:S}=await pe.get(`/api/user/get/userProfile/${f}`);if(!l){const A=S?.profile||{},W=A?.userData?.username||"";he({id:A?.userId,username:W,displayName:A?.displayName||W,avatarUrl:A?.avatarUrl})}}catch{}}return f&&k(),()=>{l=!0}},[f]),w.useEffect(()=>{if(!n.conversationId)return;const l=setTimeout(()=>{p.current&&p.current.scrollIntoView({behavior:"auto",block:"end"})},0);return()=>clearTimeout(l)},[n.conversationId]),w.useEffect(()=>{b&&p.current&&p.current.scrollIntoView({behavior:"smooth",block:"end"})},[e,n,b]),w.useEffect(()=>{if(!c.current||!p.current)return;const l=new IntersectionObserver(k=>{const S=k[0];j(S?.isIntersecting||!1),N(!0)},{root:c.current,threshold:.5});return l.observe(p.current),()=>l.disconnect()},[n.conversationId]),w.useEffect(()=>{const l=()=>ne(document.visibilityState==="visible");return document.addEventListener("visibilitychange",l),()=>document.removeEventListener("visibilitychange",l)},[]),w.useEffect(()=>{if(!n.conversationId||!B||!b||!T)return;const k=(e[n.conversationId]?.messages||[]).filter(S=>String(S.receiver)===String(x)&&!S.seenAt).map(S=>S._id);k.length&&t(wt({conversationId:n.conversationId,messageIds:k}))},[n.conversationId,B,b,T,e,x,t]),w.useEffect(()=>{if(!C)return;const l=k=>{h.current&&!h.current.contains(k.target)&&D(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[C]),w.useEffect(()=>{if(!$)return;const l=k=>{const S=v.current,A=I.current,W=k.target;S&&S.contains(W)||A&&A.contains(W)||z(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[$]),w.useEffect(()=>{if(!C||!g.current)return;const l=k=>{const S=k?.detail?.unicode||k?.detail?.emoji?.unicode||"";S&&o(A=>A+S)};return g.current.addEventListener("emoji-click",l),()=>g.current&&g.current.removeEventListener("emoji-click",l)},[C]);const re=e[n.conversationId]?.messages||[];return u.jsx(u.Fragment,{children:u.jsxs("div",{className:"dm",children:[u.jsxs("header",{className:"dm-header",children:[u.jsxs("div",{className:"hdr-left",children:[u.jsx("img",{className:"hdr-avatar",src:F?.avatarUrl||"https://via.placeholder.com/36",alt:"avatar"}),u.jsxs("div",{className:"hdr-meta",children:[u.jsx("div",{className:"hdr-name",children:F?.displayName||F?.username||"User"}),u.jsx("div",{className:"hdr-username",children:F?.username?`@${F.username}`:""})]})]}),u.jsx("div",{className:"hdr-actions",children:u.jsx("button",{ref:I,type:"button",className:`icon-btn hdr-more ${$?"open":""}`,"aria-expanded":$,onClick:()=>z(l=>!l),title:$?"Close menu":"More",children:$?u.jsx(Re,{size:18}):u.jsx(Tt,{size:20})})})]}),u.jsx("section",{className:"dm-main",children:n.conversationId?u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"dm-thread",ref:c,children:[re.map(l=>{const k=String(l.sender)===String(x);return u.jsxs("div",{className:k?"msg me":"msg other",children:[!k&&u.jsx("img",{className:"msg-avatar",src:F?.avatarUrl||"https://via.placeholder.com/28",alt:""}),u.jsxs("div",{className:k?"bubble bubble-me":"bubble bubble-other",children:[l.mediaUrl?l.mediaType?.startsWith("image/")?u.jsx("a",{href:l.mediaUrl,target:"_blank",rel:"noreferrer",children:u.jsx("img",{className:"media",src:l.mediaUrl,alt:"attachment"})}):l.mediaType?.startsWith("audio/")?u.jsx("audio",{src:l.mediaUrl,controls:!0,style:{width:220}}):l.mediaType?.startsWith("video/")?u.jsxs(u.Fragment,{children:[u.jsx("video",{className:"media",src:l.mediaUrl,controls:!0}),u.jsx("a",{href:l.mediaUrl,target:"_blank",rel:"noreferrer",className:"open-link",children:"Open"})]}):u.jsx("a",{href:l.mediaUrl,target:"_blank",rel:"noreferrer",className:"open-link",children:"Attachment"}):null,l.text?u.jsx("p",{className:"text",children:l.text}):null,u.jsxs("span",{className:"meta",children:[new Date(l.createdAt).toLocaleTimeString().slice(0,5),k&&(l.seenAt?u.jsx("span",{style:{color:"#4ea3f1",marginLeft:6},children:"✓✓"}):l.deliveredAt?u.jsx("span",{style:{opacity:.85,marginLeft:6},children:"✓✓"}):u.jsx("span",{style:{opacity:.6,marginLeft:6},children:"✓"}))]})]})]},l._id)}),u.jsx("div",{ref:p})]}),R&&u.jsxs("div",{className:"dm-preview",children:[u.jsx("div",{className:"preview-left",children:J.startsWith("image/")?u.jsx("img",{className:"preview-media",src:R,alt:"preview"}):u.jsx("video",{className:"preview-media",src:R,controls:!0})}),u.jsxs("div",{className:"preview-actions",children:[u.jsxs("button",{type:"button",className:"icon-btn btn-cancel",disabled:P,onClick:()=>{P||(R&&URL.revokeObjectURL(R),H(""),Z(null),Q(""),m.current&&(m.current.value=""))},children:[u.jsx(Re,{size:16}),u.jsx("span",{children:"Cancel"})]}),u.jsxs("button",{type:"button",className:"send-btn btn-send",title:"Send","aria-label":"Send",disabled:P,onClick:async()=>{if(!V||P)return;const l=n?.userId||f;if(l){oe(!0);try{const k=new FormData;k.append("file",V);const{data:S}=await pe.post("/api/chat/upload",k,{headers:{"Content-Type":"multipart/form-data"}});await t(ge({to:l,text:"",mediaUrl:S.url,mediaType:V.type})),setTimeout(()=>{p.current?.scrollIntoView({behavior:"smooth",block:"end"})},50)}finally{R&&URL.revokeObjectURL(R),H(""),Z(null),Q(""),m.current&&(m.current.value=""),oe(!1)}}},children:[P?u.jsx("span",{className:"spinner","aria-hidden":"true"}):u.jsx(Fe,{size:18}),u.jsx("span",{children:P?"Sending":"Send"})]})]})]}),u.jsxs("form",{className:"dm-input",onSubmit:l=>{l.preventDefault(),i.trim()&&(t(ge({to:n.userId,text:i.trim()})),o(""),D(!1))},children:[u.jsx("div",{className:"left-icons",children:u.jsx("button",{type:"button",className:"icon-btn",onClick:()=>D(l=>!l),children:u.jsx(Nt,{size:22})})}),u.jsx("input",{value:i,onChange:l=>o(l.target.value),placeholder:"Message..."}),u.jsxs("div",{className:"right-icons",children:[u.jsx("button",{type:"button",className:"icon-btn",title:"Send image/video",onClick:()=>m.current?.click(),children:u.jsx(Ct,{size:22})}),u.jsx("button",{type:"button",className:"icon-btn",title:"Like",onClick:()=>t(ge({to:n.userId,text:"❤"})),children:u.jsx(xt,{size:22})}),u.jsx("button",{type:"submit",className:"send-btn",title:"Send","aria-label":"Send",children:u.jsx(Fe,{size:18})})]}),u.jsx("input",{ref:m,type:"file",accept:"image/*,video/*",style:{display:"none"},onChange:l=>{const k=l.target.files?.[0];if(k){if(!(k.type.startsWith("image/")||k.type.startsWith("video/"))){l.target.value="";return}try{const S=URL.createObjectURL(k);Z(k),H(S),Q(k.type)}catch{l.target.value=""}}}})]}),C&&u.jsx("div",{className:"emoji-panel",ref:h,children:u.jsx("emoji-picker",{ref:g,class:"emoji-picker",set:"native",theme:"dark","skin-tones":"false"})}),$&&u.jsxs("div",{ref:v,className:"menu-popover",children:[u.jsx("button",{type:"button",className:"menu-item",onClick:()=>{const l=x,k=F?.id;k&&l&&String(k)===String(l)?a("/Profile"):k&&a(`/other/profile/${k}`),z(!1)},children:"View profile"}),u.jsx("button",{type:"button",className:"menu-item",onClick:async()=>{const l=n.conversationId;if(l)try{await t(St(l))}finally{z(!1)}},children:"Clear chat"}),u.jsx("button",{type:"button",className:"menu-item danger",onClick:async()=>{const l=n.conversationId;if(l)try{await pe.delete(`/api/chat/${l}`),a("/messages")}finally{z(!1)}},children:"Delete chat"})]})]}):u.jsx("div",{className:"msgr-empty",children:"Select a chat"})})]})})}export{po as default};
